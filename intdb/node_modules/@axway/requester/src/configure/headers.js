const debug = require('debug');

const log = debug('api-builder:request');

/**
 * Configures headers. Normalizes to lower-case and excludes any undefined.
 *
 * @param {object} httpOptions - HTTP request options:
 * https://nodejs.org/api/http.html#httprequestoptions-callback
 */
function configureHeaders(httpOptions) {
	const { _reqId: reqId } = httpOptions;
	log(reqId, 'configure headers:', httpOptions.headers);
	// normalize all headers
	const headers = {};
	for (const name in httpOptions.headers) {
		const value = httpOptions.headers[name];
		// undefined header values can cause problems
		if (value !== undefined) {
			headers[name.toLowerCase()] = httpOptions.headers[name];
		}
	}
	httpOptions.headers = headers;
	log(reqId, 'configured headers:', httpOptions.headers);
}

module.exports = configureHeaders;
