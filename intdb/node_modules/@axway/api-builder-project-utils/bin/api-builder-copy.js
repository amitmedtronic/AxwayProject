#!/usr/bin/env node

const chalk = require('chalk');
const debug = require('debug');
const projectUtils = require('../src');

const log = debug('builder:api-builder-project-utils');

const usageMsg = chalk.cyan(
	'Usage: api-builder-copy <source> <destination>');

async function copy(source, destination) {
	log('source:', source);
	log('destination:', destination);

	if (!source || !destination) {
		// eslint-disable-next-line no-console
		console.error(usageMsg);
		process.exitCode = 1;
		return;
	}
	const dstFile = await projectUtils.copyFile(source, destination);

	if (dstFile) {
		// eslint-disable-next-line no-console
		console.info('Successfully created the file:', dstFile);
	}
}

// Ignore the first two arguments - node path and the path to the script
const args = process.argv.slice(2);

const [ source, destination ] = args;

module.exports = copy(source, destination)
	.catch(ex => {
		log(ex);
		// eslint-disable-next-line no-console
		console.error(chalk.red(ex));
		// This is meant to be run as a postinstall script, so we should NOT set the exit code
		// and instead, let the install complete successfully.
	});
