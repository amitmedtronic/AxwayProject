#!/usr/bin/env node

const chalk = require('chalk');
const debug = require('debug');
const projectUtils = require('..');

const log = debug('builder:api-builder-project-utils');

const usageMsg = chalk.cyan(
	'Usage: api-builder-create-directory <destination>');

async function createDir(destination) {
	log('destination:', destination);

	if (!destination) {
		// eslint-disable-next-line no-console
		console.error(usageMsg);
		process.exitCode = 1;
		return;
	}
	const dstDir = await projectUtils.createDirectory(destination);

	if (dstDir) {
		// eslint-disable-next-line no-console
		console.info('Successfully created directory:', dstDir);
	}
}

// Ignore the first two arguments - node path and the path to the script
const args = process.argv.slice(2);

const [ destination ] = args;

module.exports = createDir(destination)
	.catch(ex => {
		log(ex);
		// eslint-disable-next-line no-console
		console.error(chalk.red(ex));
		// This is meant to be run as a postinstall script, so we should NOT set the exit code
		// and instead, let the install complete successfully.
	});
