const path = require('path');
const debug = require('debug');

const log = debug('builder:api-builder-project-utils');

/**
 * Ensures that the target directory is an API Builder service.  It will
 * attempt to require the package.json and inspect it for an
 * `@axway/api-builder-runtime` dependency and return false if either are not
 * found.
 *
 * @param {string} directory - The target directory.
 * @returns {boolean} true if the package.json contains an
 * @axway/api-builder-runtime dependency, or false, otherwise.
 */
async function isAPIBuilderProject(directory) {
	const packagePath = path.join(directory, 'package.json');
	log('packagePath:', packagePath);

	let pkg;
	try {
		pkg = require(packagePath);
	} catch (err) {
		log(err);
		log('The target directory does not contain package.json:', directory);
		return false;
	}

	const dependencies = pkg.dependencies;
	if (dependencies === undefined || !dependencies['@axway/api-builder-runtime']) {
		log('The target directory does not contain an @axway/api-builder-runtime dependency:', packagePath);
		return false;
	}
	return true;
}

module.exports = isAPIBuilderProject;
