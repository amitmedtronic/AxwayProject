const path = require('path');
const findUp = require('find-up');

/**
 * Get metadata about the plugin which wraps this module
 * @param {object} parentModule the module global passed from the plugin
 *        which uses wraps this module
 * @returns {object} the default location to load oas specs from
 *        and the name of the wrapper plugin module
 */
module.exports = async function getParentPluginInfo(parentModule) {
	// Find the closes package.json to the parent module
	const cwd = path.dirname(parentModule.filename);
	const pkgPath = await findUp('package.json', { cwd });
	// Now we have the name of the plugin that uses this module!
	const pluginName = require(pkgPath).name;
	// Now find the "swagger" directory at the root of the plugin
	// We'll use this as the default location to load specs from
	const defaultOASDir = path.join(path.dirname(pkgPath), 'openapi');
	return { defaultOASDir, pluginName };
};
