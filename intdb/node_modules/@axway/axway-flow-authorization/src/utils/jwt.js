const uuid = require('uuid');
const jwt = require('jsonwebtoken');

/**
 * Self sign JWT token using the provided subject, audience, private key and
 * passphrase
 *
 * @param {string} subject the subject
 * @param {string} audience the audience
 * @param {Object} key the private key
 * @param {string} passphrase the private key passphrase
 * @returns {Object} the signed token
 */
function sign(subject, audience, key, passphrase) {
	const signOptions = {
		issuer: `urn:ietf:params:oauth:client-assertion-type:jwt-bearer:${subject}`,
		subject,
		audience,
		expiresIn: '5m',
		algorithm: 'RS256',
		jwtid: uuid.v4()
	};
	return jwt.sign(
		// jwt payload
		{},
		{ key, passphrase },
		signOptions
	);
}

module.exports = {
	sign
};
