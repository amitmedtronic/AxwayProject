const APIProvider = require('../APIProvider');
const TriggersSchema = require('./TriggersSchema');

/**
 * API for interacting with the Endpoints.
 * @public
 */
class TriggersAPI extends APIProvider {
	static bind(controller) {
		const swagger = controller.ctx.swagger;

		swagger
			.schema('FlowTriggerDefinition', TriggersSchema.schema);

		swagger
			.get('/triggers/definitions')
			.operationId('getFlowTriggerDefinitions')
			.tag('trigger')
			.summary('Gets the registered flow-trigger plugin definitions.')
			.response(200, 'OK', TriggersSchema.schema)
			.response(500)
			.action(
				(req, res) => {
					try {
						const definitions = controller.getDefinitions();
						res.status(200).send(definitions);
					} catch (ex) {
						APIProvider.handleError(ex, res, 500);
					}
				});
	}
}

module.exports = TriggersAPI;
